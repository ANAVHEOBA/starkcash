# GhostProtocol: Smart Contract Features & Architecture

This document outlines the requirements for the Cairo smart contracts and the architectural synergy between Bitcoin and Starknet.

## Core Contract Features

### 1. Privacy Pool (The Mixer)
The central engine of the protocol, implementing the Tornado Cash logic in Cairo 1.0.
- **Deposit Function**: Accepts `tBTC` (or Mock BTC) and a cryptographic `commitment`.
- **Withdraw Function**: Verifies a ZK-SNARK proof, checks for nullifier reuse, and releases funds to the `recipient`.
- **Nullifier Registry**: A persistent on-chain mapping to prevent double-spending of the same note.

### 2. On-Chain Incremental Merkle Tree
- **Efficient Updates**: Maintaining a tree depth of 20 (1,048,576 leaves) using MiMC7 hashing.
- **Root History**: Storing the last 30-50 roots to prevent race conditions during proof generation.
- **Gas Optimization**: Leveraging Cairo's native field elements for lightning-fast hash computation.

### 3. Groth16 Verifier (The Gatekeeper)
- **Proof Validation**: Implementation of the Groth16 verification algorithm in Cairo.
- **Pairing Check**: Performing elliptic curve pairing checks (BN254) to validate the proofs generated by `rapidsnark`.
- **Public Input Binding**: Ensuring the proof is bound to the specific `nullifier_hash`, `recipient`, and `root`.

### 4. GhostPay: Link-Based Payments
- **Paymaster Integration**: Utilizing Starknet's Account Abstraction to allow "gasless" withdrawals.
- **Social Recovery**: (Future) Enabling smart account features for lost payment links.
- **Expiration Logic**: Handling timelocks for payment links.

---

## The Bitcoin-Starknet Synergy

GhostProtocol acts as a **Privacy Bridge** between the liquidity of Bitcoin and the computational power of Starknet.

### How Bitcoin enters the system
1. **Asset Source**: Bitcoin (or Testnet/Signet sats) is the primary value.
2. **Representation**: Bitcoin is represented on Starknet as an ERC-20 token (`tBTC`). In a production environment, this would be managed by a decentralized bridge (e.g., Orange, Babylon, or a multi-sig vault).
3. **The Hook**: For this hackathon, we focus on the **Privacy Layer**â€”the "Black Box" that makes Bitcoin movements untraceable once they hit Starknet.

### Why Starknet is the only choice for this
| Feature | Benefit for Bitcoin Privacy |
| :--- | :--- |
| **Native ZK-Rollup** | Starknet is "Born in ZK." Verifying complex math is cheaper here than anywhere else. |
| **Account Abstraction** | Essential for "GhostPay." Recipients don't need to own ETH/STRK to receive private BTC. |
| **Cairo 1.0** | A language designed for ZK. It allows us to implement high-performance hashing (MiMC7) that would be too expensive in Solidity. |

### The "GhostPay" Flow
1. **Sender** locks Bitcoin into the `GhostPool` contract on Starknet.
2. **Contract** generates a commitment in the Merkle Tree.
3. **Sender** creates an encrypted "Link" containing the ZK-witness.
4. **Recipient** clicks the link, generates a proof in their browser, and submits it to Starknet.
5. **Starknet** verifies the proof and sends the Bitcoin to the Recipient's wallet.

---

## Technical Specifications
- **Language**: Cairo 1.0
- **Curve**: BN254 (for compatibility with Circom/Groth16)
- **Hash**: MiMC7 (optimized for ZK circuits)
- **Target Network**: Starknet Sepolia
